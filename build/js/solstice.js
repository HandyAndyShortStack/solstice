// Generated by CoffeeScript 1.9.3
(function() {
  var allDates, allDayLengths, daysArr, height, i, j, len, len1, line, margin, studio, studios, svg, width, x, xAxis, y, yAxis;

  studios = [
    {
      "name": "Seattle Fremont Studio",
      "lat": 47.649085,
      "lon": -122.348158
    }, {
      "name": "Pioneer Square Studio",
      "lat": 47.598570,
      "lon": -122.333800
    }, {
      "name": "Denver",
      "lat": 39.749902,
      "lon": -120
    }, {
      "name": "Washington D.C.",
      "lat": 38.897681,
      "lon": -77.070522
    }, {
      "name": "Melbourne",
      "lat": -37.815717,
      "lon": 144.957161
    }, {
      "name": "Sydney",
      "lat": -33.862888,
      "lon": 151.207366
    }, {
      "name": "Adelaide",
      "lat": -34.925938,
      "lon": 138.598763
    }, {
      "name": "Perth",
      "lat": -31.952674,
      "lon": 115.851830
    }, {
      "name": "Toronto",
      "lat": 43.644021,
      "lon": -79.394552
    }, {
      "name": "London",
      "lat": 51.515392,
      "lon": -0.105597
    }, {
      "name": "Mumbai",
      "lat": 19.075984,
      "lon": 72.877656
    }, {
      "name": "Tokyo",
      "lat": 35.681183,
      "lon": 139.763770
    }, {
      "name": "Johannesburg",
      "lat": -26.060800,
      "lon": 28.085450
    }, {
      "name": "Stellenbosch",
      "lat": -33.939344,
      "lon": 18.858045
    }
  ];

  daysArr = function(startDate, endDate) {
    var arr, currentDate, nextDate;
    arr = [];
    currentDate = startDate;
    while (currentDate <= endDate) {
      arr.push(new Date(currentDate));
      nextDate = new Date(currentDate.valueOf());
      nextDate.setDate(nextDate.getDate() + 1);
      currentDate = nextDate;
    }
    return arr;
  };

  allDates = daysArr(new Date(2015, 0, 1), new Date(2015, 11, 31));

  allDayLengths = [];

  for (i = 0, len = studios.length; i < len; i++) {
    studio = studios[i];
    studio.dayLengths = allDates.map(function(date) {
      var dayLength, times;
      times = suncalc.getTimes(date, studio.lat, studio.lon);
      dayLength = (times.sunset.valueOf() - times.sunrise.valueOf()) / 3600000;
      allDayLengths.push(dayLength);
      return {
        date: date,
        dayLength: dayLength
      };
    });
  }

  margin = {
    top: 20,
    right: 20,
    bottom: 30,
    left: 50
  };

  width = 960 - margin.left - margin.right;

  height = 500 - margin.top - margin.bottom;

  x = d3.time.scale().range([0, width]);

  y = d3.scale.linear().range([height, 0]);

  xAxis = d3.svg.axis().scale(x).orient('bottom');

  yAxis = d3.svg.axis().scale(y).orient('left');

  line = d3.svg.line().x(function(d) {
    return x(d.date);
  }).y(function(d) {
    return y(d.dayLength);
  });

  svg = d3.select('section.chart').append('svg').attr('width', width + margin.left + margin.right).attr('height', height + margin.top + margin.bottom).append('g').attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

  x.domain(d3.extent(allDates));

  y.domain(d3.extent(allDayLengths));

  svg.append('g').attr('class', 'x axis').attr('transform', 'translate(0,' + height + ')').call(xAxis);

  svg.append('g').attr('class', 'y axis').call(yAxis);

  for (j = 0, len1 = studios.length; j < len1; j++) {
    studio = studios[j];
    svg.append('path').datum(studio.dayLengths).attr('class', 'line').attr('d', line);
  }

}).call(this);
