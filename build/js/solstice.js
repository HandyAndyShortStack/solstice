// Generated by CoffeeScript 1.9.3
(function() {
  var allDates, dayLengths, daysArr, height, line, margin, seattle, svg, width, x, xAxis, y, yAxis;

  seattle = {
    name: 'Seattle Fremont Studio',
    lat: 47.649085,
    lon: -122.348158
  };

  daysArr = function(startDate, endDate) {
    var arr, currentDate, nextDate;
    arr = [];
    currentDate = startDate;
    while (currentDate <= endDate) {
      arr.push(new Date(currentDate));
      nextDate = new Date(currentDate.valueOf());
      nextDate.setDate(nextDate.getDate() + 1);
      currentDate = nextDate;
    }
    return arr;
  };

  allDates = daysArr(new Date(2015, 0, 1), new Date(2015, 11, 31));

  dayLengths = allDates.map(function(date) {
    var times;
    times = suncalc.getTimes(date, seattle.lat, seattle.lon);
    return {
      date: date,
      dayLength: (times.sunset.valueOf() - times.sunrise.valueOf()) / 3600000
    };
  });

  margin = {
    top: 20,
    right: 20,
    bottom: 30,
    left: 50
  };

  width = 960 - margin.left - margin.right;

  height = 500 - margin.top - margin.bottom;

  x = d3.time.scale().range([0, width]);

  y = d3.scale.linear().range([height, 0]);

  xAxis = d3.svg.axis().scale(x).orient('bottom');

  yAxis = d3.svg.axis().scale(y).orient('left');

  line = d3.svg.line().x(function(d) {
    console.log(d.date);
    return x(d.date);
  }).y(function(d) {
    return y(d.dayLength);
  });

  svg = d3.select('section.chart').append('svg').attr('width', width + margin.left + margin.right).attr('height', height + margin.top + margin.bottom).append('g').attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

  x.domain(d3.extent(dayLengths, function(d) {
    return d.date;
  }));

  y.domain(d3.extent(dayLengths, function(d) {
    return d.dayLength;
  }));

  svg.append('g').attr('class', 'x axis').attr('transform', 'translate(0,' + height + ')').call(xAxis);

  svg.append('g').attr('class', 'y axis').call(yAxis);

  svg.append('path').datum(dayLengths).attr('class', 'line').attr('d', line);

}).call(this);
